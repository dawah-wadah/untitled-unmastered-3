{"version":3,"sources":["webpack:///webpack/bootstrap e98ae0805d06ca639f25","webpack:///./lib/main.js","webpack:///./util/api_util.js","webpack:///external \"request-promise-native\"","webpack:///external \"es6-promise\"","webpack:///external \"express\"","webpack:///./lib/location.js","webpack:///./lib/drone.js","webpack:///./node_modules/cors/lib/index.js","webpack:///external \"object-assign\"","webpack:///external \"vary\"","webpack:///./lib/package.js","webpack:///./util/dispatcher.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;;;;;;;;AC7DA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA,CAAC;;;;;;;;;;;;;;;AChBD;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA,6CAA6C,SAAS;AACtD;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,uCAAuC;AACvC;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,0CAA0C;AAC1C;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,YAAY;AACZ,GAAG;AACH;;AAEA;;;;;;;AChEA,mD;;;;;;ACAA,wC;;;;;;ACAA,oC;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,sDAAsD;AACtD;;AAEA;AACA;AACA;AACA;;AAEA;;;;;;;;AC/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;;;;;;ACjDA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,qBAAqB,0BAA0B;AAC/C;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;;AAEA;AACA;AACA;AACA,0CAA0C;AAC1C;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,qEAAqE;AACrE;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL,gDAAgD;AAChD;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL,kCAAkC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,uCAAuC,OAAO;AAC9C;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT,qCAAqC;AACrC;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;;AAEA,CAAC;;;;;;;AC7OD,0C;;;;;;ACAA,iC;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;;;;;;;;;;AClBA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,oCAAoC,qBAAqB;AACzD;AACA;AACA;AACA,gCAAgC,wCAAwC;AACxE,QAAQ;AACR;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B,sCAAsC;AAClE,IAAI;AACJ;AACA;AACA,gCAAgC,qBAAqB;AACrD,MAAM;;AAEN,aAAa;AACb,aAAa;AACb;AACA;AACA;;AAEA;;AAEA","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap e98ae0805d06ca639f25","import getData from '../util/api_util';\nimport express from 'express';\nimport cors from 'cors';\nimport dispatcher from '../util/dispatcher.js';\n\n\nconst app = express();\n\napp.get('/foo', cors(), function(req, res) {\n  getData()\n  .then( items => res.send(dispatcher(items)))\n  .catch(() => res.send('Error da fuq'));\n});\n\napp.listen(3000, function(){\n  console.log('Listening on port 3000');\n});\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib/main.js\n// module id = 0\n// module chunks = 0","import rp from 'request-promise-native';\nimport Promise from 'es6-promise';\nimport Location from '../lib/location.js';\nimport Drone from '../lib/drone.js';\nimport Package from '../lib/package.js';\n\n\nconst options = (endpoint) => {\n  return {\n    uri: `http://codetest.kube.getswift.co/${endpoint}`,\n    headers: {\n        'User-Agent': 'Request-Promise'\n    },\n    json: true\n  };\n};\n\nconst fetch = (item) => rp(options(item));\n\nconst formatDrone = data => {\n  let id = data.droneId;\n  let currentLocation = new Location({\n    latitude: data.location.latitude,\n    longitude: data.location.longitude} );\n  let homeLocation = new Location({\n    latitude: -37.816656,\n    longitude: 144.964212\n  });\n  let packages = formatPackages(data.packages);\n  let speed = 50;\n  return new Drone({\n    id, currentLocation, homeLocation, packages, speed\n  });\n};\nconst formatPackage = data => {\n  let id = data.packageId;\n  let destination = new Location({\n    latitude: data.destination.latitude,\n    longitude: data.destination.longitude} );\n  let pickupLocation = new Location({\n    latitude: -37.816656,\n    longitude: 144.964212\n  });\n  let deadline = data.deadline;\n  return new Package({\n    id, pickupLocation, destination, deadline\n  });\n};\n\nconst formatDrones = droneData => (\n  droneData.map(drone => formatDrone(drone))\n);\nconst formatPackages = packageData => (\n  packageData.map(foo => formatPackage(foo))\n);\n\nconst getData = () => (\n  Promise.all([fetch('drones'), fetch('packages')]).then(res => {\n    let drones = formatDrones(res[0]);\n    let packages = formatPackages(res[1]);\n    return {drones, packages};\n  })\n);\n\nexport default getData;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./util/api_util.js\n// module id = 1\n// module chunks = 0","module.exports = require(\"request-promise-native\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"request-promise-native\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"es6-promise\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"es6-promise\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 4\n// module chunks = 0","class Location {\n  constructor(options) {\n    this.latitude = options.latitude;\n    this.longitude = options.longitude;\n    this.distanceTo = this.distanceTo.bind(this);\n    this.deg2rad = this.deg2rad.bind(this);\n  }\n\n\n  distanceTo(location){\n    const radius = 6371;\n    const dLat = this.deg2rad(location.latitude - this.latitude);\n    const dLong = this.deg2rad(location.longitude - this.longitude);\n    const a =\n      Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n      Math.cos(this.deg2rad(this.latitude)) *\n      Math.cos(this.deg2rad(location.latitude)) *\n      Math.sin(dLong/2) + Math.sin(dLong/2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    return (radius * c) / 1000;\n  }\n\n  etaTo(location, speed = 50){\n    return (this.distanceTo(location) / speed) * 3600; // in seconds\n  }\n\n  deg2rad(deg){\n    return deg * (Math.PI/180);\n  }\n}\n\nexport default Location;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib/location.js\n// module id = 5\n// module chunks = 0","class Drone {\n  constructor(options) {\n    this.id = options.id;\n    this.homeLocation = options.homeLocation;\n    this.currentLocation = options.currentLocation;\n    this.packages = options.packages;\n    this.speed = options.speed;\n  }\n\n  etaHome(){\n    return this.currentLocation.etaTo(this.homeLocation, this.speed);\n  }\n\n  anyPackages() {\n    return Boolean(this.packages.length);\n  }\n\n  undeliverable(parcel){\n    const timeNow = new Date().getTime() / 1000 | 0;\n    return (parcel.deadline - this.availableWhen()) < timeNow;\n  }\n\n  deliveryTime(){\n    return this.packages.reduce(\n      (time, parcel) => {\n        const timeToDestination =\n          this.currentLocation\n          .etaTo(parcel.destination, this.speed);\n        const timeToHome = parcel.destination.etaTo(this.homeLocation, this.speed);\n        this.currentLocation = this.homeLocation;\n        return time + timeToDestination + timeToHome;\n      }, 0\n    );\n  }\n\n  availableWhen(){\n    return this.anyPackages() ? this.deliveryTime() : this.etaHome();\n  }\n\n}\n\nDrone.prototype.compareTimeTillAvailable = function(droneA, droneB){\n    return droneA.availableWhen() - droneB.availableWhen();\n  };\n\nDrone.prototype.soonestDrones = function(drones) {\n  return drones.sort(this.compareTimeTillAvailable);\n};\n\nexport default Drone;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib/drone.js\n// module id = 6\n// module chunks = 0","(function () {\n\n  'use strict';\n\n  var assign = require('object-assign');\n  var vary = require('vary');\n\n  var defaults = {\n      origin: '*',\n      methods: 'GET,HEAD,PUT,PATCH,POST,DELETE',\n      preflightContinue: false,\n      optionsSuccessStatus: 204\n    };\n\n  function isString(s) {\n    return typeof s === 'string' || s instanceof String;\n  }\n\n  function isOriginAllowed(origin, allowedOrigin) {\n    if (Array.isArray(allowedOrigin)) {\n      for (var i = 0; i < allowedOrigin.length; ++i) {\n        if (isOriginAllowed(origin, allowedOrigin[i])) {\n          return true;\n        }\n      }\n      return false;\n    } else if (isString(allowedOrigin)) {\n      return origin === allowedOrigin;\n    } else if (allowedOrigin instanceof RegExp) {\n      return allowedOrigin.test(origin);\n    } else {\n      return !!allowedOrigin;\n    }\n  }\n\n  function configureOrigin(options, req) {\n    var requestOrigin = req.headers.origin,\n      headers = [],\n      isAllowed;\n\n    if (!options.origin || options.origin === '*') {\n      // allow any origin\n      headers.push([{\n        key: 'Access-Control-Allow-Origin',\n        value: '*'\n      }]);\n    } else if (isString(options.origin)) {\n      // fixed origin\n      headers.push([{\n        key: 'Access-Control-Allow-Origin',\n        value: options.origin\n      }]);\n      headers.push([{\n        key: 'Vary',\n        value: 'Origin'\n      }]);\n    } else {\n      isAllowed = isOriginAllowed(requestOrigin, options.origin);\n      // reflect origin\n      headers.push([{\n        key: 'Access-Control-Allow-Origin',\n        value: isAllowed ? requestOrigin : false\n      }]);\n      headers.push([{\n        key: 'Vary',\n        value: 'Origin'\n      }]);\n    }\n\n    return headers;\n  }\n\n  function configureMethods(options) {\n    var methods = options.methods;\n    if (methods.join) {\n      methods = options.methods.join(','); // .methods is an array, so turn it into a string\n    }\n    return {\n      key: 'Access-Control-Allow-Methods',\n      value: methods\n    };\n  }\n\n  function configureCredentials(options) {\n    if (options.credentials === true) {\n      return {\n        key: 'Access-Control-Allow-Credentials',\n        value: 'true'\n      };\n    }\n    return null;\n  }\n\n  function configureAllowedHeaders(options, req) {\n    var allowedHeaders = options.allowedHeaders || options.headers;\n    var headers = [];\n\n    if (!allowedHeaders) {\n      allowedHeaders = req.headers['access-control-request-headers']; // .headers wasn't specified, so reflect the request headers\n      headers.push([{\n        key: 'Vary',\n        value: 'Access-Control-Request-Headers'\n      }]);\n    } else if (allowedHeaders.join) {\n      allowedHeaders = allowedHeaders.join(','); // .headers is an array, so turn it into a string\n    }\n    if (allowedHeaders && allowedHeaders.length) {\n      headers.push([{\n        key: 'Access-Control-Allow-Headers',\n        value: allowedHeaders\n      }]);\n    }\n\n    return headers;\n  }\n\n  function configureExposedHeaders(options) {\n    var headers = options.exposedHeaders;\n    if (!headers) {\n      return null;\n    } else if (headers.join) {\n      headers = headers.join(','); // .headers is an array, so turn it into a string\n    }\n    if (headers && headers.length) {\n      return {\n        key: 'Access-Control-Expose-Headers',\n        value: headers\n      };\n    }\n    return null;\n  }\n\n  function configureMaxAge(options) {\n    var maxAge = options.maxAge && options.maxAge.toString();\n    if (maxAge && maxAge.length) {\n      return {\n        key: 'Access-Control-Max-Age',\n        value: maxAge\n      };\n    }\n    return null;\n  }\n\n  function applyHeaders(headers, res) {\n    for (var i = 0, n = headers.length; i < n; i++) {\n      var header = headers[i];\n      if (header) {\n        if (Array.isArray(header)) {\n          applyHeaders(header, res);\n        } else if (header.key === 'Vary' && header.value) {\n          vary(res, header.value);\n        } else if (header.value) {\n          res.setHeader(header.key, header.value);\n        }\n      }\n    }\n  }\n\n  function cors(options, req, res, next) {\n    var headers = [],\n      method = req.method && req.method.toUpperCase && req.method.toUpperCase();\n\n    if (method === 'OPTIONS') {\n      // preflight\n      headers.push(configureOrigin(options, req));\n      headers.push(configureCredentials(options, req));\n      headers.push(configureMethods(options, req));\n      headers.push(configureAllowedHeaders(options, req));\n      headers.push(configureMaxAge(options, req));\n      headers.push(configureExposedHeaders(options, req));\n      applyHeaders(headers, res);\n\n      if (options.preflightContinue ) {\n        next();\n      } else {\n        // Safari (and potentially other browsers) need content-length 0,\n        //   for 204 or they just hang waiting for a body\n        res.statusCode = options.optionsSuccessStatus || defaults.optionsSuccessStatus;\n        res.setHeader('Content-Length', '0');\n        res.end();\n      }\n    } else {\n      // actual response\n      headers.push(configureOrigin(options, req));\n      headers.push(configureCredentials(options, req));\n      headers.push(configureExposedHeaders(options, req));\n      applyHeaders(headers, res);\n      next();\n    }\n  }\n\n  function middlewareWrapper(o) {\n    // if options are static (either via defaults or custom options passed in), wrap in a function\n    var optionsCallback = null;\n    if (typeof o === 'function') {\n      optionsCallback = o;\n    } else {\n      optionsCallback = function (req, cb) {\n        cb(null, o);\n      };\n    }\n\n    return function corsMiddleware(req, res, next) {\n      optionsCallback(req, function (err, options) {\n        if (err) {\n          next(err);\n        } else {\n          var corsOptions = assign({}, defaults, options);\n          var originCallback = null;\n          if (corsOptions.origin && typeof corsOptions.origin === 'function') {\n            originCallback = corsOptions.origin;\n          } else if (corsOptions.origin) {\n            originCallback = function (origin, cb) {\n              cb(null, corsOptions.origin);\n            };\n          }\n\n          if (originCallback) {\n            originCallback(req.headers.origin, function (err2, origin) {\n              if (err2 || !origin) {\n                next(err2);\n              } else {\n                corsOptions.origin = origin;\n                cors(corsOptions, req, res, next);\n              }\n            });\n          } else {\n            next();\n          }\n        }\n      });\n    };\n  }\n\n  // can pass either an options hash, an options delegate, or nothing\n  module.exports = middlewareWrapper;\n\n}());\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/cors/lib/index.js\n// module id = 7\n// module chunks = 0","module.exports = require(\"object-assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"object-assign\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"vary\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"vary\"\n// module id = 9\n// module chunks = 0","class Package {\n  constructor(options) {\n    this.id = options.id;\n    this.destination = options.destination;\n    this.pickupLocation = options.pickupLocation;\n    this.deadline = options.deadline;\n  }\n\n  maximumWaitTime(speed){\n    return this.deadline - this.destination.etaTo(this.pickupLocation, speed);\n  }\n}\n\nPackage.prototype.soonestPackages = (packages) => (\n  packages.sort((a, b) => a.maximumWaitTime(50) - b.maximumWaitTime(50))\n);\n\n\nexport default Package;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib/package.js\n// module id = 10\n// module chunks = 0","import Drone from '../lib/drone.js';\nimport Package from '../lib/package.js';\n\nconst dispatcher = (foo) => {\n  // const orderedDrones = Drone.soonestDrones(foo.drones);\n  // const orderedDrones = foo.drones.map(drone => drone.etaHome())\n  //   .sort((a,b) => a - b);\n  const orderedPackages = Package.soonestPackages(foo.packages);\n  // const unassignedPackages = [];\n  // const assignedPackages = [];\n\n  // orderedDrones.forEach( drone => {\n  //   let parcel;\n  //   if (orderedPackages.length) {\n  //     parcel = orderedPackages.shift();\n  //     if (drone.undeliverable(parcel)) {\n  //       unassignedPackages.push({packageId: parcel.id});\n  //       parcel = orderedPackages.shift();\n  //       if (!parcel) return;\n  //     }\n  //     assignedPackages.push({droneId: drone.id, packageId: parcel.id});\n  //   } else {\n  //     return;\n  //   }\n  // });\n//   orderedDrones.forEach(drone => {\n//   let pack = orderedPackages.shift();\n//   if (!pack) return;\n//   while (drone.undeliverable(pack)){\n//     unassignedPackages.push(pack.id);\n//     pack = orderedPackages.shift();\n//     if (!pack) return;\n//   }\n//   assignedPackages.push({droneID: drone.id, packageID: pack.id});\n// });\n//\n//   orderedPackages.map((parcel) => {\n//     unassignedPackages.push({packageId: parcel.id});\n//   });\n\n  // return {assignedPackages, unassignedPackages};\n  // return { orderedDrones };\n  // console.log(foo.packages);\n  // return foo.packages;\n  return foo.drones\n\n};\n\nexport default dispatcher;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./util/dispatcher.js\n// module id = 11\n// module chunks = 0"],"sourceRoot":""}